<!doctype html>
<meta name="viewport" content="width=device-width, initial-scale=1">


	<script src="jquery.min.js"></script>
	<script src="jquery-ui.min.js"></script>



<title>term.js</title>

<style>
  html {
    background: #555;
  }

  h1 {
    margin-bottom: 20px;
    font: 20px/1.5 sans-serif;
  }

</style>
<script src="/socket.io/socket.io.js"></script>

<button id=but>click</button>

<div id=term_div style="background-color:#555;">
</div>

<script src="term.js"></script>
<script>

var socket = null;

$("#but").on('click', () => {
	if(socket == null)
	{
		socket = io.connect('127.0.0.1', {'forceNew': true})
		$("#term_div").html('<table id=tab><tr><td id=col></td></tr></table>')
		//console.log('new socket')
	}

	socket.on('connect', on_socket_connect);
});

function on_socket_connect()
{
      var term = new Terminal({
        cols: 80,
        rows: 24,
        useStyle: true,
        screenKeys: true,
        cursorBlink: true
      });

      term.on('data', function(data) {
		console.log('emite : ' + data)
		if(glob == 'bs')
        console.log('backspace');
        console.log(glob);
        socket.emit('data', data);
      });

      term.on('title', function(title) {
        document.title = title;
      });

      term.open(document.getElementById("col"));

      term.write('\x1b[31mWelcome to programming terminal. Press ENTER to continue.!\x1b[m\r\n');

      socket.on('data', function(data) {
        term.write(data);
        //console.log('data: ' + data + ' ' + data.length);

        if(data == 'exit') {
        	$("#col").html('<b>Session over</b>')
			socket.disconnect()
			socket = null
        }

      });

      socket.on('disconnect', function() {
        term.destroy();
              console.log('destroyed')
      });

}

</script>


